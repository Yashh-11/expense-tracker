<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>ExpenseHub - Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #0f172a, #020617);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #e5e7eb;
    }

    .navbar-custom {
      background: rgba(15, 23, 42, 0.98) !important;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
      backdrop-filter: blur(12px);
    }

    .brand-title {
      font-weight: 700;
      letter-spacing: 0.03em;
      font-size: 1.05rem;
      color: #e5e7eb;
    }

    .brand-badge {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(56, 189, 248, 0.15);
      color: #7dd3fc;
      border: 1px solid rgba(56, 189, 248, 0.45);
    }

    .main-wrapper {
      padding: 18px 12px 28px;
    }

    @media (min-width: 992px) {
      .main-wrapper {
        padding-inline: 40px;
      }
    }

    .glass-card {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 20px;
      border: 1px solid rgba(55, 65, 81, 0.8);
      box-shadow: 0 20px 70px rgba(0, 0, 0, 0.7);
    }

    .section-title {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
      margin-bottom: 10px;
    }

    .form-label {
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .glass-input,
    .glass-select {
      background: rgba(15, 23, 42, 0.88);
      border-radius: 12px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      color: #e5e7eb;
      font-size: 0.9rem;
      padding: 9px 11px;
    }

    .glass-input:focus,
    .glass-select:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.7);
      background: rgba(15, 23, 42, 0.96);
    }

    .btn-save {
      border-radius: 999px;
      background: linear-gradient(135deg, #6366f1, #4f46e5);
      border: none;
      font-size: 0.9rem;
      font-weight: 600;
      box-shadow: 0 16px 40px rgba(79, 70, 229, 0.6);
    }

    .btn-save:hover {
      background: linear-gradient(135deg, #4f46e5, #4338ca);
      transform: translateY(-1px);
    }

    .btn-outline-light-custom {
      border-radius: 999px;
      border-color: rgba(148, 163, 184, 0.65);
      color: #e5e7eb;
      font-size: 0.8rem;
      padding-inline: 12px;
      padding-block: 6px;
    }

    .btn-outline-light-custom:hover {
      background: rgba(148, 163, 184, 0.16);
      border-color: rgba(209, 213, 219, 0.9);
    }

    table {
      font-size: 0.88rem;
      color: #e5e7eb;
    }

    thead {
      background: rgba(15, 23, 42, 0.98);
    }

    thead th {
      border-bottom-color: rgba(55, 65, 81, 0.9) !important;
      font-weight: 500;
      color: #9ca3af;
      text-transform: uppercase;
      font-size: 0.78rem;
    }

    tbody tr {
      border-color: rgba(31, 41, 55, 0.9);
    }

    tbody tr:nth-child(even) {
      background: rgba(15, 23, 42, 0.9);
    }

    tbody tr:nth-child(odd) {
      background: rgba(15, 23, 42, 0.8);
    }

    .amount-cell {
      font-weight: 600;
      color: #facc15;
    }

    .badge-category {
      border-radius: 999px;
      padding: 4px 9px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    #tableBody td {
      vertical-align: middle;
    }

    #message {
      font-size: 0.85rem;
    }

    .summary-pill {
      font-size: 0.8rem;
      color: #9ca3af;
    }
  </style>
</head>

<body>

  <nav class="navbar navbar-expand-lg navbar-dark navbar-custom sticky-top">
    <div class="container-fluid px-3 px-lg-4">
      <span class="brand-title d-flex align-items-center gap-2">
        ExpenseHub
        <span class="brand-badge">Dashboard</span>
      </span>
      <div class="d-flex align-items-center gap-3 ms-auto">
        <span id="userName" class="text-sm text-muted" style="font-size: 0.85rem;"></span>
        <button class="btn btn-outline-light-custom" onclick="logout()">Logout</button>
      </div>
    </div>
  </nav>

  <div class="main-wrapper">
    <div class="row g-4">
      <!-- Left column: Form -->
      <div class="col-lg-4">
        <div class="glass-card p-3 p-md-4 h-100">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <div>
              <div class="section-title">New Expense</div>
              <h5 class="mb-0" id="formHeading">Add expense entry</h5>
            </div>
          </div>

          <p class="text-muted mb-3" style="font-size: 0.8rem;">
            Quickly log your daily purchases. You can always edit or delete them later.
          </p>

          <div id="message" class="alert d-none" role="alert"></div>

          <form id="expenseForm" class="mt-2">
            <input type="hidden" id="editId">

            <div class="mb-2">
              <label class="form-label">Expense Name</label>
              <input id="name" class="form-control glass-input" placeholder="e.g. Zomato order" required>
            </div>

            <div class="row">
              <div class="col-sm-6 mb-2">
                <label class="form-label">Amount (₹)</label>
                <input type="number" id="amount" min="1" class="form-control glass-input" placeholder="0.00" required>
              </div>
              <div class="col-sm-6 mb-2">
                <label class="form-label">Date</label>
                <input type="date" id="date" class="form-control glass-input" required>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Category</label>
              <select id="category" class="form-select glass-select text-white" required>
                <option value="">Select category</option>
                <option>Food</option>
                <option>Travel</option>
                <option>Bills</option>
                <option>Shopping</option>
                <option>Other</option>
              </select>
            </div>

            <button type="submit" class="btn btn-save w-100 mt-1">
              Save Expense
            </button>

            <p class="summary-pill mt-2 mb-0">
              Tip: Use clear names like “Bus pass”, “Electricity bill”, etc. Makes history easier to read.
            </p>
          </form>
        </div>
      </div>

      <!-- Right column: Table + filters -->
      <div class="col-lg-8">
        <div class="glass-card p-3 p-md-4">
          <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
            <div>
              <div class="section-title mb-1">Expense History</div>
              <h5 class="mb-0">Your logged expenses</h5>
            </div>

            <div class="d-flex flex-wrap gap-2">
              <select id="sortDate" class="form-select form-select-sm glass-select" style="width: 160px;">
                <option value="desc">Newest first</option>
                <option value="asc">Oldest first</option>
              </select>
              <select id="filter" class="form-select form-select-sm glass-select" style="width: 160px;">
                <option value="all">All categories</option>
                <option>Food</option>
                <option>Travel</option>
                <option>Bills</option>
                <option>Shopping</option>
                <option>Other</option>
              </select>
            </div>
          </div>

          <div class="table-responsive rounded-3" style="border: 1px solid rgba(55,65,81,0.9); overflow: hidden;">
            <table class="table mb-0 align-middle">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Amount (₹)</th>
                  <th>Date</th>
                  <th>Category</th>
                  <th class="text-end" style="width: 130px;">Actions</th>
                </tr>
              </thead>
              <tbody id="tableBody">
                <!-- rows rendered by JS -->
              </tbody>
            </table>
          </div>

          <p id="emptyText" class="text-muted mt-3 mb-0" style="font-size: 0.85rem; display:none;">
            You haven’t added any expenses yet. Start by logging your first transaction on the left.
          </p>
        </div>
      </div>
    </div>
  </div>

  <script src="config.js"></script>
  <script>
    // ✅ JS code unchanged (localStorage-based dashboard)

    const user = getCurrentUser();
    if (!user) location.href = "login.html";
    document.getElementById("userName").textContent = `Hi, ${user.name}!`;

    let all = JSON.parse(localStorage.getItem("expenses-" + user.email) || "[]");

    function save() {
      localStorage.setItem("expenses-" + user.email, JSON.stringify(all));
    }

    function render() {
      let sort = document.getElementById("sortDate").value;
      let filter = document.getElementById("filter").value;

      let list = [...all];
      if (filter !== "all") list = list.filter(x => x.category === filter);
      list.sort((a, b) => sort === "asc" ? new Date(a.date) - new Date(b.date) : new Date(b.date) - new Date(a.date));

      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = "";

      if (list.length === 0) {
        document.getElementById("emptyText").style.display = "block";
        return;
      } else {
        document.getElementById("emptyText").style.display = "none";
      }

      list.forEach(e => {
        tbody.innerHTML += `
        <tr>
          <td>${e.name}</td>
          <td class="amount-cell">₹${e.amount}</td>
          <td>${e.date}</td>
          <td><span class="badge bg-slate-700 badge-category text-black">${e.category}</span></td>
          <td class="text-end">
            <button class="btn btn-sm btn-outline-light-custom me-1" onclick='edit(${e.id})'>Edit</button>
            <button class="btn btn-sm btn-outline-danger" onclick='del(${e.id})'>Del</button>
          </td>
        </tr>`;
      });
    }

    document.getElementById("expenseForm").addEventListener("submit", e => {
      e.preventDefault();
      let id = document.getElementById("editId").value;
      let obj = {
        id: id ? Number(id) : Date.now(),
        name: document.getElementById("name").value,
        amount: document.getElementById("amount").value,
        date: document.getElementById("date").value,
        category: document.getElementById("category").value
      };

      if (id) {
        all = all.map(x => x.id == id ? obj : x);
      } else all.push(obj);

      save();
      render();
      e.target.reset();
      document.getElementById("editId").value = "";
    });

    function edit(id) {
      const e = all.find(x => x.id == id);
      document.getElementById("editId").value = e.id;
      document.getElementById("name").value = e.name;
      document.getElementById("amount").value = e.amount;
      document.getElementById("date").value = e.date;
      document.getElementById("category").value = e.category;
    }

    function del(id) {
      if (!confirm("Are you sure you want to delete this expense?")) return;
      all = all.filter(x => x.id != id);
      save();
      render();
    }

    document.getElementById("sortDate").onchange = render;
    document.getElementById("filter").onchange = render;

    // Initialize date field with today
    try {
      document.getElementById("date").valueAsDate = new Date();
    } catch (e) { }

    render();
  </script>
</body>

</html>